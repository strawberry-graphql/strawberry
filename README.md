
 # Strawberry SQLAlchemy Mapper
<img src="https://github.com/strawberry-graphql/strawberry/raw/main/.github/logo.png" width="124" height="150">

[![PyPI Version][pypi-badge]][pypi-url]  [![Python 3.8+][python-badge]][python-url]

Strawberry-sqlalchemy-mapper is the simplest way to implement autogenerated strawberry types for columns and relationships in SQLAlchemy models.

## ‚ú® Key Features
- **Auto-generate** Strawberry types from SQLAlchemy models
- **Automatic batching** of queries (N+1 prevention)
- **Native support** for most SQLAlchemy types
- **Lightweight** and fast
- Supports **SQLAlchemy >=1.4.x**

## üì¶ Getting Started

### Installation
```bash
pip install strawberry-sqlalchemy-mapper
```

### Basic Usage
1. Define your SQLAlchemy model:
```python
# models.py
from sqlalchemy import Column, String, UUID, ForeignKey
from sqlalchemy.orm import relationship, declarative_base

Base = declarative_base()

class Employee(Base):
    __tablename__ = "employee"
    id = Column(UUID, primary_key=True)
    name = Column(String, nullable=False)
    password_hash = Column(String, nullable=False)
    department_id = Column(UUID, ForeignKey("department.id"))
    department = relationship("Department", back_populates="employees")

class Department(Base):
    __tablename__ = "department"
    id = Column(UUID, primary_key=True)
    name = Column(String, nullable=False)
    employees = relationship("Employee", back_populates="department")
```

2. Create Strawberry types:
```python
from strawberry_sqlalchemy_mapper import StrawberrySQLAlchemyMapper

mapper = StrawberrySQLAlchemyMapper()

@mapper.type(Employee)
class EmployeeType:
    __exclude__ = ["password_hash"]  # Exclude sensitive fields

@mapper.type(Department)
class DepartmentType:
    pass
```

3. Set up your schema:
```python
from strawberry.type import strawberry
from sqlalchemy import select

@strawberry.type
class Query:
    @strawberry.field
    def departments(self) -> List[DepartmentType]:
        return session.scalars(select(Department)).all()

schema = strawberry.Schema(query=Query)
mapper.finalize()  # Finalize all mappings
```

## üß© Advanced Features

### Polymorphic Types
```python
class Book(Base):
    id = Column(UUID, primary_key=True)

class Novel(Book):
    pass

# In schema:
@mapper.interface(Book)
class BookInterface:
    pass

@mapper.type(Novel)
class NovelType:
    pass
```

### Supported SQLAlchemy Types
| SQLAlchemy Type | Strawberry Type | Notes |
|----------------|----------------|-------|
| `Integer` | `int` | |
| `DateTime` | `datetime` | |
| `JSON` | `strawberry.scalars.JSON` | |
| `ARRAY[T]` | `List[T]` | PostgreSQL arrays |
| `Enum` | `strawberry.enum` | Must be decorated |

## ‚ö†Ô∏è Limitations
- **TypeDecorator**: Limited support (may need manual implementation)
- **Association proxies**: Must follow `association_proxy('relationship1', 'relationship2')` pattern
- **Complex hierarchies**: Require explicit interface registration

## ü§ù Contributing
We encourage you to contribute! Please follow these steps:

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

### Development Setup
```bash
pip install pre-commit
pre-commit install
pre-commit autoupdate
pip install -r requirements.txt
```

## ‚öñÔ∏è License
MIT ¬© [strawberry-sqlalchemy-mapper](LICENSE.txt)

<!-- Badge links -->
[pypi-badge]: https://img.shields.io/pypi/v/strawberry-sqlalchemy-mapper?color=blue
[pypi-url]: https://pypi.org/project/strawberry-sqlalchemy-mapper/
[python-badge]: https://img.shields.io/badge/python-3.8%2B-blue
[python-url]: https://www.python.org/
[ci-badge]: https://github.com/strawberry-graphql/strawberry-sqlalchemy-mapper/actions/workflows/tests.yml/badge.svg
[ci-url]: https://github.com/strawberry-graphql/strawberry-sqlalchemy-mapper/actions
[coverage-badge]: https://codecov.io/gh/strawberry-graphql/strawberry-sqlalchemy-mapper/branch/main/graph/badge.svg
[coverage-url]: https://codecov.io/gh/strawberry-graphql/strawberry-sqlalchemy-mapper
```
